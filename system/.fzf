eval "$(fzf --${SHELL_NAME}))"

export FZF_DEFAULT_COMMAND='fd . -H -i -E .git'

export FZF_DEFAULT_OPTS="\
--ignore-case \
--multi \
--color=dark,fg:gray \
--layout=reverse \
--height=50% \
--border=rounded \
--margin=2%,2%,2%,2% \
--border-label='[ Warm fuzzy feeling ]' \
--border-label-pos=-5 \
--prompt '∷ ' \
--pointer ▶ \
--marker ⇒"

export FZF_CTRL_R_OPTS="\
--bind 'ctrl-y:execute-silent(echo -n {2..} | pbcopy)+abort' \
--color header:italic \
--header 'Press CTRL-Y to copy command into clipboard' \
"

# REVISIT: a way to place the header at the bottom, while prompt is at the top (reverse layout)
export FZF_CTRL_T_OPTS="\
--preview='stat {}' \
--preview-label='[ Preview ]' \
--preview-label-pos='3:bottom' \
\
--bind='ctrl-e:change-prompt(:: )' \
--bind='ctrl-e:+reload(eval $FZF_DEFAULT_COMMAND)' \
--bind='ctrl-e:+change-preview(stat {})' \
--bind='ctrl-e:+refresh-preview' \
\
--bind='ctrl-d:change-prompt(Dirs :: )' \
--bind='ctrl-d:+reload(eval $FZF_DEFAULT_COMMAND -t d)' \
--bind='ctrl-d:+change-preview(tree -C {})' \
--bind='ctrl-d:+refresh-preview' \
\
--bind='ctrl-f:change-prompt(Files :: )' \
--bind='ctrl-f:+reload(eval $FZF_DEFAULT_COMMAND -t f)' \
--bind='ctrl-f:+change-preview(bat --paging=never --decorations=never {})' \
--bind='ctrl-f:+refresh-preview' \
\
--bind='ctrl-p:toggle-preview' \
--bind='ctrl-a:select-all' \
--bind='ctrl-x:deselect-all' \
--header '
Directories (CTRL-d) | Files (CTRL-f) | Default (CTRL-r)
Select all (CTRL-a) | Deselect all (CTRL-x)
Toggle preview (CTRL-p)
'
"

fb() {

    # Store the STDOUT of fzf in a variable
    selection=$(find . -type d | fzf \
    --multi \
    --height=80% \
    --border=sharp \
    --preview='tree -C {}' \
    --preview-window='45%,border-sharp' \
    --prompt='Dirs > ' \
    --bind='ctrl-p:toggle-preview' \
    --bind='ctrl-d:change-prompt(Dirs > )' \
    --bind='ctrl-d:+reload(find . -type d)' \
    --bind='ctrl-d:+change-preview(tree -C {})' \
    --bind='ctrl-d:+refresh-preview' \
    --bind='ctrl-f:change-prompt(Files > )' \
    --bind='ctrl-f:+reload(find . -type f)' \
    --bind='ctrl-f:+change-preview(cat {})' \
    --bind='ctrl-f:+refresh-preview' \
    --bind='ctrl-a:select-all' \
    --bind='ctrl-x:deselect-all' \
    --header '
    CTRL-D to display directories | CTRL-F to display files
    CTRL-A to select all | CTRL-x to deselect all
    ENTER to edit | DEL to delete
    CTRL-P to toggle preview
    '
    )

    # Determine what to do depending on the selection
    # BUG: if nothing is selected, the editor still opens
    if [ -d "$selection" ]; then
        cd "$selection" || exit
    else
        eval "$EDITOR $selection"
    fi

}
