eval "$(fzf --${SHELL_NAME}))"

export FZF_DEFAULT_COMMAND='fd . -HiE .git'

export FZF_DEFAULT_OPTS="\
--ignore-case \
--multi \
--color=dark,fg:gray \
--layout=reverse \
--height=50% \
--border=rounded \
--margin=2%,2%,2%,2% \
--border-label='[ Warm fuzzy feeling ]' \
--border-label-pos=-5 \
--prompt '∷ ' \
--pointer ▶ \
--marker ⇒"

export FZF_CTRL_R_OPTS="\
--bind 'ctrl-y:execute-silent(echo -n {2..} | pbcopy)+abort' \
--color header:italic \
--header 'Press CTRL-Y to copy command into clipboard' \
"

# REVISIT: a way to place the header at the bottom, while prompt is at the top (reverse layout)
export FZF_CTRL_T_OPTS="\
--preview='stat {}' \
--preview-label='[ Preview ]' \
--preview-label-pos='3:bottom' \
\
--bind='ctrl-r:change-prompt(:: )' \
--bind='ctrl-r:+reload(eval $FZF_DEFAULT_COMMAND)' \
--bind='ctrl-r:+change-preview(stat {})' \
--bind='ctrl-r:+refresh-preview' \
\
--bind='ctrl-d:change-prompt(Dirs :: )' \
--bind='ctrl-d:+reload(eval $FZF_DEFAULT_COMMAND -t d)' \
--bind='ctrl-d:+change-preview(tree -C {})' \
--bind='ctrl-d:+refresh-preview' \
\
--bind='ctrl-f:change-prompt(Files :: )' \
--bind='ctrl-f:+reload(eval $FZF_DEFAULT_COMMAND -t f)' \
--bind='ctrl-f:+change-preview(bat --paging=never --decorations=never {})' \
--bind='ctrl-f:+refresh-preview' \
\
--bind='ctrl-p:toggle-preview' \
--bind='ctrl-a:select-all' \
--bind='ctrl-x:deselect-all' \
--header '
CTRL-D (dirs) | CTRL-F (files) | CTRL-E (everything)
CTRL-A (select all) | CTRL-X (de-select all)
CTRL-P (toggle preview)
'
"

export FZF_COMPLETION_DIR_COMMANDS="cd pushd rmdir tree"

export FZF_COMPLETION_OPTS="\
"

_fzf_comprun() {
    local command=$1
    shift

    case "$command" in
    tree) fd . -HiE .git -t d | fzf --preview 'tree -C {}' "$@" ;;
    *) fzf "$@" ;;
    esac
}
